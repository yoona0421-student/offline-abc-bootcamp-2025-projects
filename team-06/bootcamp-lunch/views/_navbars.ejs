<nav class="navbar">
  <a href="/" class="navbar-brand">ğŸš€ ë¶€ìº ëŸ°ì¹˜</a>
  <div class="navbar-nav">
    <% if (user) { %>
      <!-- ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ -->
      <span class="welcome-msg"><strong><%= user.name %></strong>ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</span>
      <button id="myPartiesBtn" class="btn btn-info">ğŸ‰ ë‚´ íŒŒí‹° ë³´ê¸°</button>
      <div id="myPartiesPopup" class="my-parties-popup">
        <h3>ğŸˆ ì°¸ì—¬ ì¤‘ì¸ íŒŒí‹°</h3>
        <ul class="my-parties-list">
          <% if (locals.myParties && myParties.length > 0) { %>
            <% myParties.forEach(party => {
              const isHost = user.name === party.host_name;
            %>
              <li>
                <div class="party-info">
                  <strong><%= party.title %></strong>
                  <small>
                    <div>â° <%= party.meet_time %></div>
                    <div>ğŸ“ <%= party.location || 'ë¯¸ì •' %></div>
                    <div>ğŸ‘¥ <%= party.current_members %>/<%= party.max_members %>ëª… ì°¸ì—¬ ì¤‘</div>
                  </small>
                </div>
                <% if (!isHost) { %>
                  <form action="/party/<%= party.id %>/leave" method="POST" class="leave-party-form">
                    <button type="submit" class="btn btn-danger btn-leave" onclick="return confirm('ì •ë§ë¡œ ì´ íŒŒí‹°ë¥¼ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')">ë‚˜ê°€ê¸°</button>
                  </form>
                <% } else { %>
                  <span class="host-badge">ì£¼ìµœì</span>
                <% } %>
              </li>
            <% }); %>
          <% } else { %>
            <li>
              <strong>ì•„ì§ ì°¸ì—¬í•œ íŒŒí‹°ê°€ ì—†ì–´ìš”</strong>
              <small>ìƒˆë¡œìš´ íŒŒí‹°ì— ì°¸ì—¬í•´ë³´ì„¸ìš”! ğŸ‰</small>
            </li>
          <% } %>
        </ul>
      </div>
      <a href="/logout" class="btn btn-outline">ë¡œê·¸ì•„ì›ƒ</a>
    <% } else { %>
      <!-- ë¡œê·¸ì•„ì›ƒ ìƒíƒœì¼ ë•Œ -->
      <a href="/login" class="btn btn-outline">ë¡œê·¸ì¸</a>
      <a href="/signup" class="btn btn-primary">íšŒì›ê°€ì…</a>
    <% } %>
  </div>
</nav>

<% if (locals.message) { %>
  <div id="messageAlert" class="message-alert <%= locals.message.type %> show">
    <%= locals.message.text %>
    <button class="close-btn" onclick="this.parentNode.classList.remove('show');">&times;</button>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const messageAlert = document.getElementById('messageAlert');
      if (messageAlert) {
        setTimeout(() => {
          messageAlert.classList.remove('show');
        }, 2500); // 2.5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
      }
    });
  </script>
<% } %>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const myPartiesBtn = document.getElementById('myPartiesBtn');
    const myPartiesPopup = document.getElementById('myPartiesPopup');
    
    if (myPartiesBtn && myPartiesPopup) {
      myPartiesBtn.addEventListener('click', () => {
        myPartiesPopup.classList.toggle('show');
      });

      // íŒì—… ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
      document.addEventListener('click', (event) => {
        if (!myPartiesBtn.contains(event.target) && !myPartiesPopup.contains(event.target)) {
          myPartiesPopup.classList.remove('show');
        }
      });
    }
  });
</script>
