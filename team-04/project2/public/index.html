<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê°ì • ê¸°ë°˜ ë…¸ë˜ ì¶”ì²œ</title>
  <style>
    @font-face {
      font-family: 'GmarketSansLight';
      src: url('./fonts/GmarketSansLight.ttf') format('truetype');
      font-weight: 300;
      font-style: normal;
    }
    @font-face {
      font-family: 'GmarketSansMedium';
      src: url('./fonts/GmarketSansMedium.ttf') format('truetype');
      font-weight: 500;
      font-style: normal;
    }
    @font-face {
      font-family: 'GmarketSansBold';
      src: url('./fonts/GmarketSansBold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      min-height: 100vh;
      width: 100vw;
      font-family: 'GmarketSansMedium', sans-serif;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      /* ì¸ì‚¬ì´ë“œ ì•„ì›ƒ ìŠ¤í‹¸ì»· ë°°ê²½ + ì–´ë‘ìš´ ì˜¤ë²„ë ˆì´ */
      background:
        linear-gradient(rgba(30,30,30,0.7), rgba(30,30,30,0.7)),
        url('./images/backgrouund.jpg') center/cover no-repeat;
      background-attachment: fixed;
      overflow-x: hidden;
    }

    /* ìŠ¤ë§ˆíŠ¸í° í”„ë ˆì„ */
    .phone-frame {
      background: rgba(20, 20, 20, 0.92);
      border-radius: 36px;
      box-shadow: 0 0 0 8px #222, 0 8px 40px 0 #ff6e7f55;
      width: 370px;
      max-width: 96vw;
      height: 90vh;
      max-height: 700px;
      min-height: 540px;
      margin: 40px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32px 18px 32px 18px;
      position: relative;
      overflow: auto;
    }
    /* ìƒë‹¨ ìŠ¤í”¼ì»¤/ì¹´ë©”ë¼ */
    .phone-notch {
      width: 60px;
      height: 10px;
      background: #333;
      border-radius: 8px;
      margin: 0 auto 18px auto;
      opacity: 0.7;
    }

    h1, h2, h3, p, label, .emotion-label {
      text-align: center !important;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      font-family: 'GmarketSansBold';
      font-size: 2.1rem;
      margin-bottom: 8px;
      letter-spacing: -1px;
      color: #fff;
      text-shadow: 0 2px 12px #232526, 0 0px 2px #ffe066, 0 0px 10px #232526;
      /* ê·¸ë¼ë°ì´ì…˜ ì œê±°, ê·¸ë¦¼ì ê°•ì¡° */
    }
    h3 {
      font-family: 'GmarketSansLight';
      font-size: 1.1rem;
      margin-bottom: 28px;
      color: #adb5bd;
    }

    /* ì¸ì‚¬ì´ë“œ ì•„ì›ƒ êµ¬ìŠ¬ ìŠ¤íƒ€ì¼ ê°ì • ì¹´ë“œ */
    .emotion-container {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .emotion-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: none;
      border: none;
      box-shadow: none;
      cursor: pointer;
      margin-bottom: 2px;
      transition: transform 0.18s, box-shadow 0.18s;
      width: 70px;
    }
    .emotion-img {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: 0 4px 16px rgba(0,0,0,0.18), 0 0 0 4px rgba(255,255,255,0.08);
      border: 3px solid #fff;
      transition: transform 0.18s, box-shadow 0.18s, border 0.18s;
    }
    .emotion-card:hover .emotion-img,
    .emotion-card.selected .emotion-img {
      transform: translateY(-6px) scale(1.10);
      z-index: 2;
    }
    /* ê°ì •ë³„ ë„¤ì˜¨ ì»¬ëŸ¬ ë§¤í•‘ */
    .emotion-card[data-emotion="ê¸°ì¨ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ê¸°ì¨ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #ffe06699, 0 2px 8px #ffe06677, 0 0 0 6px #ffe06655;
      border: 3px solid #ffe066;
    }
    .emotion-card[data-emotion="ìŠ¬í””ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ìŠ¬í””ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #74c0fc99, 0 2px 8px #748ffc77, 0 0 0 6px #74c0fc55;
      border: 3px solid #74c0fc;
    }
    .emotion-card[data-emotion="ë²„ëŸ­ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ë²„ëŸ­ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #ff6b6b99, 0 2px 8px #fa525299, 0 0 0 6px #ff6b6b55;
      border: 3px solid #ff6b6b;
    }
    .emotion-card[data-emotion="ê¹Œì¹ ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ê¹Œì¹ ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #63e6be99, 0 2px 8px #38d9a999, 0 0 0 6px #63e6be55;
      border: 3px solid #63e6be;
    }
    .emotion-card[data-emotion="ì†Œì‹¬ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ì†Œì‹¬ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #b197fc99, 0 2px 8px #845ef799, 0 0 0 6px #b197fc55;
      border: 3px solid #b197fc;
    }
    .emotion-card[data-emotion="ë¶ˆì•ˆì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ë¶ˆì•ˆì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #ffa94d99, 0 2px 8px #ff922b99, 0 0 0 6px #ffa94d55;
      border: 3px solid #ffa94d;
    }
    .emotion-card[data-emotion="ë¶€ëŸ½ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ë¶€ëŸ½ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #63e6e2cc, 0 2px 8px #38d9ec99, 0 0 0 6px #63e6e255;
      border: 3px solid #63e6e2;
    }
    .emotion-card[data-emotion="ë”°ë¶„ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ë”°ë¶„ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #4263eb99, 0 2px 8px #364fc799, 0 0 0 6px #4263eb55;
      border: 3px solid #4263eb;
    }
    .emotion-card[data-emotion="ë‹¹í™©ì´"]:hover .emotion-img,
    .emotion-card[data-emotion="ë‹¹í™©ì´"].selected .emotion-img {
      box-shadow: 0 8px 32px #f783ac99, 0 2px 8px #e6498099, 0 0 0 6px #f783ac55;
      border: 3px solid #f783ac;
    }
    .emotion-label {
      margin-top: 8px;
      color: #fff;
      font-weight: bold;
      font-size: 1em;
      letter-spacing: 0.5px;
      text-align: center;
      background: none;
      pointer-events: none;
    }
    .emotion-keyword {
      font-size: 0.92em;
      color: #ffe066;
      margin-bottom: 12px;
      margin-top: -2px;
      font-weight: 500;
      letter-spacing: 0.2em;
      text-shadow: 0 1px 6px #23252699;
    }

    .chatbot-input {
      display: none;
      margin: 18px 0 0 0;
      text-align: center;
      background: #f8f9fa;
      border-radius: 18px;
      box-shadow: 0 2px 8px #adb5bd33;
      padding: 18px 0 10px 0;
    }
    .chatbot-input input {
      width: 90%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      margin-bottom: 10px;
      background: #333;
      color: #fff;
      text-align: center;
    }
    .chatbot-input p,
    .chatbot-input .light {
      color: #232526; /* ê²€ì •ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */
    }

    #recommendations {
      margin-top: 24px;
      text-align: center;
    }
    .recommend-title {
      font-size: 1.15em;
      font-weight: bold;
      margin: 18px 0 10px 0;
      color: #fff; /* íŒŒë€ìƒ‰(#3b5bdb) â†’ í°ìƒ‰(#fff)ìœ¼ë¡œ ë³€ê²½ */
      letter-spacing: 0.03em;
      text-shadow: 0 1px 6px #23252699;
    }
    .track-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }
    .track-card {
      background: url('./images/chat.png') center/cover no-repeat;
      color: #232526;
      padding: 14px 10px 10px 10px;
      border-radius: 18px;
      box-shadow: 0 2px 8px #ffe06655;
      font-size: 1.01rem;
      font-weight: 500;
      width: 230px;
      max-width: 90vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.2s;
      text-align: center;
      position: relative;
      border: 2px solid #fff; /* í…Œë‘ë¦¬ì„ ì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
    }
    .track-card .track-keyword {
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      color: #232526;
      font-size: 0.85em;
      font-weight: bold;
      border-radius: 10px;
      padding: 2px 10px;
      box-shadow: 0 2px 8px #ffe06655;
      letter-spacing: 0.1em;
    }
    .track-card a {
      color: #ff3b3b; /* music play ë¹¨ê°„ìƒ‰ */
      font-weight: bold;
      text-decoration: none;
      margin-left: 8px;
      font-size: 0.98em;
    }
    .track-card a:hover {
      text-decoration: underline;
    }

    button {
      margin-top: 10px;
      padding: 12px 22px;
      border: none;
      background: #fff;           /* í°ìƒ‰ ë°°ê²½ */
      color: #ff3b3b;             /* ê¸€ì”¨ ë¹¨ê°„ìƒ‰ */
      border-radius: 16px;
      cursor: pointer;
      font-size: 1.08rem;
      font-family: 'GmarketSansMedium';
      font-weight: bold;
      box-shadow: 0 2px 8px #ffe06655;
      transition: background 0.2s, color 0.2s;
      display: inline-block;
      text-align: center;
      border: 2px solid #ff3b3b; /* í…Œë‘ë¦¬ë„ ë¹¨ê°„ìƒ‰ */
    }
    button:hover {
      background: #ff3b3b;        /* ë°°ê²½ ë¹¨ê°„ìƒ‰ */
      color: #fff;                /* ê¸€ì”¨ í°ìƒ‰ */
    }

    @media (max-width: 600px) {
      .phone-frame {
        width: 98vw;
        min-height: 90vh;
        padding: 10vw 2vw;
      }
      .emotion-container {
        gap: 8px;
      }
      .emotion-card {
        width: 60px;
        height: 80px;
        font-size: 1.3rem;
      }
    }
    @media (max-width: 420px) {
      .phone-frame {
        width: 100vw;
        min-width: unset;
        padding: 8vw 2vw;
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <div class="phone-frame">
    <div class="phone-notch"></div>
    <h2>ê¸°ë¶„ ë§í•˜ì§€ ë§ê³  ë…¸ë˜ë¡œ ë§í•´ğŸ¤</h2>
    <h4>ì¸ì‚¬ì´ë“œì•„ì›ƒ ìºë¦­í„°ë“¤ê³¼ í•˜ë£°ë¼ë¼ğŸª½ ê°€ëŠ”ğŸƒ musicğŸ§ playlist</h4>
    <div class="emotion-container" id="emotionCards">
      <div class="emotion-card" data-emotion="ê¸°ì¨ì´" onclick="selectEmotion('ê¸°ì¨ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/joy.png')"></div>
        <div class="emotion-label">ê¸°ì¨ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ìŠ¬í””ì´" onclick="selectEmotion('ìŠ¬í””ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/sadness.png')"></div>
        <div class="emotion-label">ìŠ¬í””ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ë²„ëŸ­ì´" onclick="selectEmotion('ë²„ëŸ­ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/anger.png')"></div>
        <div class="emotion-label">ë²„ëŸ­ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ê¹Œì¹ ì´" onclick="selectEmotion('ê¹Œì¹ ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/disgust.png')"></div>
        <div class="emotion-label">ê¹Œì¹ ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ì†Œì‹¬ì´" onclick="selectEmotion('ì†Œì‹¬ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/fear.png')"></div>
        <div class="emotion-label">ì†Œì‹¬ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ë¶ˆì•ˆì´" onclick="selectEmotion('ë¶ˆì•ˆì´', this)">
        <div class="emotion-img" style="background-image:url('./images/anxiety.png')"></div>
        <div class="emotion-label">ë¶ˆì•ˆì´</div>
      </div>
      <div class="emotion-card" data-emotion="ë¶€ëŸ½ì´" onclick="selectEmotion('ë¶€ëŸ½ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/envy.png')"></div>
        <div class="emotion-label">ë¶€ëŸ½ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ë”°ë¶„ì´" onclick="selectEmotion('ë”°ë¶„ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/boredom.png')"></div>
        <div class="emotion-label">ë”°ë¶„ì´</div>
      </div>
      <div class="emotion-card" data-emotion="ë‹¹í™©ì´" onclick="selectEmotion('ë‹¹í™©ì´', this)">
        <div class="emotion-img" style="background-image:url('./images/embarrassment.png')"></div>
        <div class="emotion-label">ë‹¹í™©ì´</div>
      </div>
    </div>

    <button onclick="openChatbot()">ë‚´ ê°ì •ì´ ì—†ì–´ìš”ğŸ˜¢</button>

    <div class="chatbot-input" id="chatbotSection">
      <p class="light">ë‹¹ì‹ ì˜ ê¸°ë¶„ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ í‘œí˜„í•´ ì£¼ì„¸ìš”ğŸ˜Š</p>
      <input type="text" id="userEmotionInput" placeholder="ex: ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ì–´ìš”" />
      <button onclick="sendToGPT()">ë³´ë‚´ê¸°</button>
    </div>

    <div id="recommendations"></div>
  </div>
  <script>
    const emotionColors = {
      "í–‰ë³µ": "#ffe066",
      "ìŠ¬í””": "#748ffc",
      "í”¼ê³¤": "#adb5bd",
      "í™”ë‚¨": "#f03e3e",
      "ì„¤ë ˜": "#d0bfff"
    };

    // ê°ì •ë³„ í‚¤ì›Œë“œ(ì„¤ëª…) ë§¤í•‘
    const emotionKeywords = {
      "ê¸°ì¨ì´": "ê¸°ì¨",
      "ìŠ¬í””ì´": "ìŠ¬í””",
      "ë²„ëŸ­ì´": "í™”ë‚¨",
      "ê¹Œì¹ ì´": "ê¹Œì¹ ",
      "ì†Œì‹¬ì´": "ì†Œì‹¬",
      "ë¶ˆì•ˆì´": "ë¶ˆì•ˆ",
      "ë¶€ëŸ½ì´": "ë¶€ëŸ½",
      "ë”°ë¶„ì´": "ë”°ë¶„",
      "ë‹¹í™©ì´": "ë‹¹í™©"
    };

    function openChatbot() {
      document.getElementById("chatbotSection").style.display = "block";
    }

    async function sendToGPT() {
      const userInput = document.getElementById("userEmotionInput").value;
      const response = await fetch("/api/emotion", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ input: userInput })
      });

      const data = await response.json();
      if (data.emotion) {
        selectEmotion(data.emotion);
      } else {
        document.getElementById("recommendations").innerHTML = `<p>ê°ì • ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>`;
      }
    }

    let selectedCard = null;
    async function selectEmotion(emotion, cardEl) {
      // ì¹´ë“œ ì„ íƒ íš¨ê³¼
      if (selectedCard) selectedCard.classList.remove('selected');
      if (cardEl) {
        cardEl.classList.add('selected');
        selectedCard = cardEl;
      }

      document.getElementById("recommendations").innerHTML = `<p style="color:#ffe066"><strong>ì¶”ì²œ ì¤‘...</strong></p>`;

      try {
        const response = await fetch("/api/recommend", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ emotion })
        });

        const songs = await response.json();
        const resultDiv = document.getElementById("recommendations");

        if (!Array.isArray(songs) || songs.length === 0) {
          resultDiv.innerHTML = `<p>ì¶”ì²œëœ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤. ê°ì •ì„ ë‹¤ì‹œ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>`;
          return;
        }

        // ì¶”ì²œ ê²°ê³¼ ë ˆì´ì•„ì›ƒ ê°œì„ 
        resultDiv.innerHTML = `
          <div class="recommend-title">
            ğŸ™ï¸<span class="track-keyword">${emotionKeywords[emotion] || emotion}</span> ê¸°ë¶„ì— ì–´ìš¸ë¦¬ëŠ” ì¶”ì²œ ê³¡ğŸ™ï¸
          </div>
          <div class="track-list"></div>
        `;

        const trackList = resultDiv.querySelector('.track-list');
        songs.forEach(({ title, artist }) => {
          const query = encodeURIComponent(`${title} ${artist}`);
          const url = `https://music.youtube.com/search?q=${query}`;
          trackList.innerHTML += `
            <div class="track-card">
              <div><strong>${title}</strong></div>
              <div style="font-size:0.97em; color:#555; margin:4px 0 6px 0;">${artist}</div>
              <a href="${url}" target="_blank">ğŸ§ music play</a>
            </div>
          `;
        });
      } catch (err) {
        console.error("ì¶”ì²œ ì‹¤íŒ¨", err);
        document.getElementById("recommendations").innerHTML = `<p>ì¶”ì²œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>`;
      }
    }

    // ê°ì • ì¹´ë“œ ë°°ê²½ìƒ‰ ìë™ ì ìš©
    document.addEventListener("DOMContentLoaded", () => {
      const cards = document.querySelectorAll(".emotion-card");
      cards.forEach(card => {
        const label = card.querySelector(".emotion-label")?.textContent;
        if (label && emotionColors[label]) {
          card.style.backgroundColor = emotionColors[label];
        }
      });
    });
  </script>
</body>
</html>
